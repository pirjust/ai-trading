# å®å¡”é¢æ¿éƒ¨ç½²æ¸…å•

## ğŸ“‹ å¿«é€Ÿéƒ¨ç½²æŒ‡å—

### ç¬¬ä¸€æ­¥ï¼šä¸‹è½½å¹¶æ‰§è¡Œä¸€é”®éƒ¨ç½²è„šæœ¬

```bash
# 1. ä¸‹è½½éƒ¨ç½²è„šæœ¬
wget -O baota_deploy.sh https://raw.githubusercontent.com/your-repo/baota_oneclick_deploy.sh

# 2. èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x baota_deploy.sh

# 3. æ‰§è¡Œéƒ¨ç½²ï¼ˆéœ€è¦rootæƒé™ï¼‰
sudo ./baota_deploy.sh
```

### ç¬¬äºŒæ­¥ï¼šå®å¡”é¢æ¿åç»­é…ç½®

ç™»å½•å®å¡”é¢æ¿åï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºé…ç½®ï¼š

#### 1. å®‰å…¨è®¾ç½®
- [ ] ä¿®æ”¹é¢æ¿ç«¯å£ï¼š8888 â†’ 19999
- [ ] ä¿®æ”¹ç”¨æˆ·åå’Œå¯†ç 
- [ ] å¼€å¯SSLè¯ä¹¦
- [ ] è®¾ç½®è®¤è¯è®¿é—®

#### 2. è½¯ä»¶å®‰è£…ï¼ˆè½¯ä»¶å•†åº—ï¼‰
- [ ] **Nginx 1.22+** - WebæœåŠ¡å™¨
- [ ] **PostgreSQL 13+** - ä¸»æ•°æ®åº“
- [ ] **Redis 6.0+** - ç¼“å­˜æ•°æ®åº“
- [ ] **Pythoné¡¹ç›®ç®¡ç†å™¨** - Pythonåº”ç”¨ç®¡ç†

#### 3. ç½‘ç«™é…ç½®
- [ ] åˆ›å»ºç½‘ç«™ï¼šåŸŸåæˆ–IPåœ°å€
- [ ] æ ¹ç›®å½•ï¼š`/www/wwwroot/ai-trading/frontend/dist`
- [ ] é…ç½®Nginxåå‘ä»£ç†

## ğŸ”§ è¯¦ç»†é…ç½®æ­¥éª¤

### 1. å®å¡”é¢æ¿å®‰å…¨é…ç½®

#### 1.1 ä¿®æ”¹é¢æ¿ç«¯å£
```bash
# åœ¨å®å¡”é¢æ¿ä¸­æ“ä½œï¼š
# é¢æ¿è®¾ç½® â†’ å®‰å…¨è®¾ç½® â†’ ä¿®æ”¹é¢æ¿ç«¯å£

# å‘½ä»¤è¡Œä¿®æ”¹é˜²ç«å¢™
sudo ufw delete allow 8888/tcp
sudo ufw allow 19999/tcp
```

#### 1.2 ç»‘å®šåŸŸåå’ŒSSL
```bash
# åœ¨é¢æ¿è®¾ç½®ä¸­ç»‘å®šåŸŸå
# é¢æ¿è®¾ç½® â†’ ç»‘å®šåŸŸå â†’ è¾“å…¥æ‚¨çš„åŸŸå

# ç”³è¯·SSLè¯ä¹¦
# é¢æ¿è®¾ç½® â†’ é¢æ¿SSL â†’ Let's Encrypt â†’ ç”³è¯·è¯ä¹¦
```

### 2. è½¯ä»¶å®‰è£…è¯¦ç»†æ­¥éª¤

#### 2.1 Nginxé…ç½®
```nginx
# åœ¨ç½‘ç«™é…ç½®ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹
server {
    listen 80;
    server_name your-domain.com;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /www/wwwroot/ai-trading/frontend/dist;
        index index.html;
        try_files $uri $uri/ /index.html;
    }
    
    # APIåå‘ä»£ç†
    location /api/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

#### 2.2 PostgreSQLæ•°æ®åº“é…ç½®

1. **åˆ›å»ºæ•°æ®åº“**
   - æ•°æ®åº“åï¼š`ai_trading`
   - ç”¨æˆ·åï¼š`ai_trader`
   - å¯†ç ï¼š`è®¾ç½®å¼ºå¯†ç `

2. **æ€§èƒ½ä¼˜åŒ–é…ç½®**
```sql
-- åœ¨PostgreSQLé…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹
max_connections = 200
shared_buffers = 512MB
effective_cache_size = 2GB
work_mem = 16MB
maintenance_work_mem = 128MB
```

3. **å¯¼å…¥æ•°æ®åº“ç»“æ„**
```bash
# ä½¿ç”¨psqlå¯¼å…¥
psql -h localhost -U ai_trader -d ai_trading -f scripts/init_database.sql
```

#### 2.3 Redisé…ç½®

åœ¨å®å¡”é¢æ¿çš„Redisè®¾ç½®ä¸­ï¼š
- å†…å­˜é™åˆ¶ï¼š`2GB`
- å¯†ç ï¼š`è®¾ç½®Rediså¯†ç `
- ä¿å­˜ç­–ç•¥ï¼š`allkeys-lru`

### 3. Pythonç¯å¢ƒé…ç½®

#### 3.1 åˆ›å»ºPythoné¡¹ç›®

åœ¨Pythoné¡¹ç›®ç®¡ç†å™¨ä¸­ï¼š
- é¡¹ç›®åç§°ï¼š`ai-trading-api`
- é¡¹ç›®è·¯å¾„ï¼š`/www/wwwroot/ai-trading`
- Pythonç‰ˆæœ¬ï¼š`3.9`
- å¯åŠ¨æ–¹å¼ï¼š`gunicorn`
- å¯åŠ¨æ–‡ä»¶ï¼š`app/main:app`
- ç»‘å®šåœ°å€ï¼š`127.0.0.1:8000`

#### 3.2 ç¯å¢ƒå˜é‡é…ç½®

åœ¨é¡¹ç›®è®¾ç½®çš„ç¯å¢ƒå˜é‡ä¸­æ·»åŠ ï¼š
```bash
DATABASE_URL=postgresql://ai_trader:your_password@localhost:5432/ai_trading
REDIS_URL=redis://:your_redis_password@localhost:6379/0
API_KEY=your_api_key
SECRET_KEY=your_secret_key
DEBUG=False
LOG_LEVEL=INFO
```

#### 3.3 å®‰è£…Pythonä¾èµ–
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /www/wwwroot/ai-trading

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source /opt/ai-trading/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¦‚æœrequirements.txtä¸å­˜åœ¨ï¼Œæ‰‹åŠ¨å®‰è£…
pip install fastapi uvicorn gunicorn psycopg2-binary redis \
    pandas numpy ccxt torch scikit-learn prometheus-client psutil
```

## ğŸš€ éƒ¨ç½²åéªŒè¯

### 1. æœåŠ¡çŠ¶æ€æ£€æŸ¥

```bash
# æ£€æŸ¥å®å¡”é¢æ¿
systemctl status bt

# æ£€æŸ¥Nginx
systemctl status nginx
nginx -t

# æ£€æŸ¥PostgreSQL
systemctl status postgresql

# æ£€æŸ¥Redis
systemctl status redis
```

### 2. ç«¯å£ç›‘å¬æ£€æŸ¥

```bash
# æ£€æŸ¥ç«¯å£ç›‘å¬çŠ¶æ€
netstat -tlnp | grep -E "(80|443|19999|5432|6379|8000)"

# é¢„æœŸè¾“å‡º
# tcp6       0      0 :::80                   :::*                    LISTEN      nginx
# tcp6       0      0 :::443                  :::*                    LISTEN      nginx
# tcp6       0      0 :::19999                :::*                    LISTEN      python
# tcp6       0      0 :::5432                 :::*                    LISTEN      postgres
# tcp6       0      0 :::6379                 :::*                    LISTEN      redis
# tcp6       0      0 :::8000                 :::*                    LISTEN      python
```

### 3. åº”ç”¨åŠŸèƒ½æµ‹è¯•

#### 3.1 å‰ç«¯è®¿é—®æµ‹è¯•
```bash
# æµ‹è¯•å‰ç«¯é¡µé¢
curl -I http://your-domain.com
# åº”è¯¥è¿”å›200çŠ¶æ€ç 
```

#### 3.2 APIæ¥å£æµ‹è¯•
```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥æ¥å£
curl http://your-domain.com/api/health
# åº”è¯¥è¿”å›{"status":"healthy"}

# æµ‹è¯•APIæ–‡æ¡£
curl http://your-domain.com/api/docs
```

#### 3.3 æ•°æ®åº“è¿æ¥æµ‹è¯•
```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
psql -h localhost -U ai_trader -d ai_trading -c "SELECT version();"

# æµ‹è¯•Redisè¿æ¥
redis-cli -h localhost -p 6379 -a your_redis_password ping
```

## ğŸ”’ å®‰å…¨é…ç½®æ¸…å•

### 1. é˜²ç«å¢™é…ç½®

```bash
# æŸ¥çœ‹å½“å‰é˜²ç«å¢™è§„åˆ™
sudo ufw status verbose

# ç¡®ä¿åªæœ‰å¿…è¦ç«¯å£å¼€æ”¾
sudo ufw allow 22/tcp      # SSH
sudo ufw allow 80/tcp      # HTTP
sudo ufw allow 443/tcp     # HTTPS
sudo ufw allow 19999/tcp   # å®å¡”é¢æ¿
sudo ufw allow 5432/tcp    # PostgreSQL
sudo ufw allow 6379/tcp    # Redis
sudo ufw allow 8000/tcp    # APIæœåŠ¡

# æ‹’ç»å…¶ä»–æ‰€æœ‰è¿æ¥
sudo ufw default deny incoming
sudo ufw default allow outgoing
```

### 2. SSHå®‰å…¨é…ç½®

```bash
# å¤‡ä»½åŸé…ç½®
sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup

# ç¼–è¾‘SSHé…ç½®
sudo vim /etc/ssh/sshd_config

# ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š
Port 2222
PermitRootLogin no
PasswordAuthentication no
PubkeyAuthentication yes
MaxAuthTries 3
ClientAliveInterval 300
ClientAliveCountMax 2

# é‡å¯SSHæœåŠ¡
sudo systemctl restart ssh

# æ›´æ–°é˜²ç«å¢™
sudo ufw delete allow 22/tcp
sudo ufw allow 2222/tcp
```

### 3. Fail2bané…ç½®

```bash
# å®‰è£…fail2ban
sudo apt install -y fail2ban

# åˆ›å»ºé…ç½®æ–‡ä»¶
sudo vim /etc/fail2ban/jail.local
```

```ini
[DEFAULT]
# å…¨å±€è®¾ç½®
bantime = 3600
findtime = 600
maxretry = 3

[sshd]
# SSHä¿æŠ¤
enabled = true
port = 2222
filter = sshd
logpath = /var/log/auth.log
maxretry = 3
bantime = 3600

[nginx-http-auth]
# Nginxè®¤è¯ä¿æŠ¤
enabled = true
filter = nginx-http-auth
port = http,https
logpath = /var/log/nginx/error.log
maxretry = 3
bantime = 3600

[postgresql]
# PostgreSQLä¿æŠ¤
enabled = true
filter = postgresql
port = 5432
logpath = /var/log/postgresql/postgresql-13-main.log
maxretry = 3
bantime = 3600
```

```bash
# å¯åŠ¨fail2ban
sudo systemctl enable fail2ban
sudo systemctl start fail2ban

# æ£€æŸ¥çŠ¶æ€
sudo fail2ban-client status
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—é…ç½®

### 1. ç³»ç»Ÿç›‘æ§è®¾ç½®

#### 1.1 å®å¡”é¢æ¿ç›‘æ§
- è¿›å…¥ **ç›‘æ§** â†’ **ç³»ç»Ÿç›‘æ§**
- è®¾ç½®å‘Šè­¦é˜ˆå€¼ï¼š
  - CPUä½¿ç”¨ç‡ï¼š80%
  - å†…å­˜ä½¿ç”¨ç‡ï¼š85%
  - ç£ç›˜ä½¿ç”¨ç‡ï¼š90%

#### 1.2 åº”ç”¨ç›‘æ§
```bash
# æŸ¥çœ‹Pythonåº”ç”¨æ—¥å¿—
tail -f /www/server/panel/plugin/python/total_logs/ai-trading-api.log

# æŸ¥çœ‹Nginxè®¿é—®æ—¥å¿—
tail -f /www/wwwlogs/access.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /www/wwwlogs/error.log
```

### 2. æ—¥å¿—è½®è½¬é…ç½®

```bash
# åˆ›å»ºæ—¥å¿—è½®è½¬é…ç½®
sudo vim /etc/logrotate.d/ai-trading
```

```
/www/wwwroot/ai-trading/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    copytruncate
}
```

## ğŸš¨ æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. å®å¡”é¢æ¿æ— æ³•è®¿é—®

**ç—‡çŠ¶**ï¼šæµè§ˆå™¨æ— æ³•æ‰“å¼€å®å¡”é¢æ¿

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æ£€æŸ¥é˜²ç«å¢™
sudo ufw status

# 2. æ£€æŸ¥ç«¯å£ç›‘å¬
sudo netstat -tlnp | grep 19999

# 3. é‡å¯å®å¡”æœåŠ¡
sudo /etc/init.d/bt restart

# 4. æŸ¥çœ‹é¢æ¿æ—¥å¿—
sudo tail -f /www/server/panel/logs/error.log
```

#### 2. Pythonåº”ç”¨å¯åŠ¨å¤±è´¥

**ç—‡çŠ¶**ï¼šPythoné¡¹ç›®ç®¡ç†å™¨æ˜¾ç¤ºåº”ç”¨çŠ¶æ€å¼‚å¸¸

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æ£€æŸ¥ä¾èµ–åŒ…
cd /www/wwwroot/ai-trading
source /opt/ai-trading/bin/activate
pip list | grep -E "(fastapi|uvicorn|gunicorn)"

# 2. æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f /www/server/panel/plugin/python/total_logs/ai-trading-api.log

# 3. æ‰‹åŠ¨å¯åŠ¨æµ‹è¯•
cd /www/wwwroot/ai-trading
source /opt/ai-trading/bin/activate
python -m uvicorn app.main:app --host 127.0.0.1 --port 8000
```

#### 3. æ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶**ï¼šåº”ç”¨æ— æ³•è¿æ¥æ•°æ®åº“

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æ£€æŸ¥æ•°æ®åº“æœåŠ¡çŠ¶æ€
systemctl status postgresql

# 2. æµ‹è¯•æ•°æ®åº“è¿æ¥
psql -h localhost -U ai_trader -d ai_trading

# 3. æ£€æŸ¥é…ç½®æ–‡ä»¶
cat /www/server/pgsql/data/pg_hba.conf | grep -v "^#"

# 4. æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
tail -f /www/server/pgsql/data/log/postgresql-*.log
```

#### 4. Nginxé…ç½®é”™è¯¯

**ç—‡çŠ¶**ï¼šç½‘ç«™è¿”å›502é”™è¯¯æˆ–æ— æ³•è®¿é—®

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æ£€æŸ¥Nginxé…ç½®è¯­æ³•
sudo nginx -t

# 2. æ£€æŸ¥åå‘ä»£ç†é…ç½®
sudo cat /www/server/panel/vhost/nginx/your-domain.com.conf

# 3. é‡å¯Nginx
sudo systemctl restart nginx

# 4. æŸ¥çœ‹Nginxé”™è¯¯æ—¥å¿—
tail -f /www/wwwlogs/error.log
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. Nginxæ€§èƒ½ä¼˜åŒ–

```nginx
# åœ¨Nginxé…ç½®ä¸­æ·»åŠ 
gzip on;
gzip_min_length 1k;
gzip_comp_level 2;
gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

# è¿æ¥æ± ä¼˜åŒ–
worker_processes auto;
worker_connections 1024;
keepalive_timeout 65;

# é™æ€æ–‡ä»¶ç¼“å­˜
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    access_log off;
}
```

### 2. PostgreSQLæ€§èƒ½ä¼˜åŒ–

```sql
-- åˆ›å»ºç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
CREATE INDEX CONCURRENTLY idx_trades_timestamp ON trades(timestamp);
CREATE INDEX CONCURRENTLY idx_users_email ON users(email);

-- å®šæœŸç»´æŠ¤
VACUUM ANALYZE trades;
VACUUM ANALYZE users;

-- ç›‘æ§æ…¢æŸ¥è¯¢
SELECT query, total_time, calls, mean_time 
FROM pg_stat_statements 
ORDER BY mean_time DESC 
LIMIT 10;
```

### 3. Pythonåº”ç”¨ä¼˜åŒ–

```python
# ä½¿ç”¨Gunicorné…ç½®ä¼˜åŒ–
# åˆ›å»ºgunicorn_config.py
bind = "127.0.0.1:8000"
workers = 4
worker_class = "uvicorn.workers.UvicornWorker"
threads = 2
max_requests = 1000
max_requests_jitter = 100
preload_app = True
```

## ğŸ“ æŠ€æœ¯æ”¯æŒè”ç³»æ–¹å¼

### æ—¥å¿—æ–‡ä»¶ä½ç½®

| ç»„ä»¶ | æ—¥å¿—è·¯å¾„ | ç”¨é€” |
|------|----------|------|
| å®å¡”é¢æ¿ | `/www/server/panel/logs/` | é¢æ¿æ“ä½œæ—¥å¿— |
| Nginx | `/www/wwwlogs/` | ç½‘ç«™è®¿é—®æ—¥å¿— |
| PostgreSQL | `/www/server/pgsql/data/log/` | æ•°æ®åº“æ—¥å¿— |
| Redis | `/var/log/redis/` | ç¼“å­˜æ—¥å¿— |
| Pythonåº”ç”¨ | `/www/wwwroot/ai-trading/logs/` | åº”ç”¨æ—¥å¿— |
| ç³»ç»Ÿæ—¥å¿— | `/var/log/` | ç³»ç»Ÿçº§æ—¥å¿— |

### é‡å¯æœåŠ¡å‘½ä»¤

```bash
# å®å¡”é¢æ¿
sudo /etc/init.d/bt restart

# Nginx
sudo systemctl restart nginx

# PostgreSQL
sudo systemctl restart postgresql

# Redis
sudo systemctl restart redis

# Pythonåº”ç”¨ï¼ˆé€šè¿‡å®å¡”ï¼‰
# åœ¨Pythoné¡¹ç›®ç®¡ç†å™¨ä¸­é‡å¯
```

### ç´§æ€¥è”ç³»æ–¹å¼

- **æœåŠ¡å™¨ä¾›åº”å•†æŠ€æœ¯æ”¯æŒ**
- **åŸŸåæ³¨å†Œå•†æŠ€æœ¯æ”¯æŒ**
- **ç³»ç»Ÿç®¡ç†å‘˜è”ç³»æ–¹å¼**

---

## âœ… éƒ¨ç½²å®Œæˆæ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥
- [ ] æœåŠ¡å™¨èµ„æºå……è¶³ï¼ˆCPUâ‰¥2æ ¸ï¼Œå†…å­˜â‰¥4GBï¼‰
- [ ] ç½‘ç»œè¿æ¥ç¨³å®š
- [ ] åŸŸåè§£ææ­£ç¡®ï¼ˆå¦‚ä½¿ç”¨åŸŸåï¼‰
- [ ] å¤‡ä»½é‡è¦æ•°æ®

### éƒ¨ç½²ä¸­æ£€æŸ¥
- [ ] å®å¡”é¢æ¿å®‰è£…æˆåŠŸ
- [ ] å¿…è¦è½¯ä»¶å®‰è£…å®Œæˆ
- [ ] Pythonç¯å¢ƒé…ç½®æ­£ç¡®
- [ ] æ•°æ®åº“æœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] é˜²ç«å¢™é…ç½®å®Œæˆ

### éƒ¨ç½²åæ£€æŸ¥
- [ ] ç½‘ç«™å¯æ­£å¸¸è®¿é—®
- [ ] APIæ¥å£å“åº”æ­£å¸¸
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] ç›‘æ§ç³»ç»Ÿè¿è¡Œæ­£å¸¸
- [ ] å®‰å…¨é…ç½®ç”Ÿæ•ˆ

---

*æ–‡æ¡£ç‰ˆæœ¬: v2.0*  
*æœ€åæ›´æ–°: 2024å¹´11æœˆ*  
*é€‚ç”¨ç³»ç»Ÿ: Ubuntu/CentOS/Debian*  
*å®å¡”ç‰ˆæœ¬: 7.9.0+*